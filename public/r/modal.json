{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "modal",
  "description": "Accessible modal dialog with focus trap and animations",
  "registryDependencies": [
    "utils"
  ],
  "files": [
    {
      "path": "src/molecules/Modal/Modal.tsx",
      "content": "import {\n  forwardRef,\n  useEffect,\n  useRef,\n  useCallback,\n  useId,\n  useState,\n  type HTMLAttributes,\n  type ReactNode,\n} from 'react'\nimport { createPortal } from 'react-dom'\nimport { cn } from '../../utils/cn'\n\nexport type ModalSize = 'sm' | 'md' | 'lg' | 'full'\n\nexport interface ModalProps extends Omit<HTMLAttributes<HTMLDivElement>, 'role'> {\n  /** Whether the modal is open */\n  isOpen: boolean\n  /** Callback when modal should close */\n  onClose: () => void\n  /** Modal content */\n  children: ReactNode\n  /** Size of the modal panel */\n  size?: ModalSize\n  /** Whether clicking the backdrop closes the modal */\n  closeOnBackdropClick?: boolean\n  /** Whether pressing Escape closes the modal */\n  closeOnEscape?: boolean\n  /** Accessible label for the modal (used if no Modal.Header is provided) */\n  ariaLabel?: string\n}\n\nconst FOCUSABLE_SELECTOR =\n  'a[href], button:not([disabled]), input:not([disabled]), select:not([disabled]), textarea:not([disabled]), [tabindex]:not([tabindex=\"-1\"])'\n\nconst sizeClasses: Record<ModalSize, string> = {\n  sm: 'max-w-[400px]',\n  md: 'max-w-[560px]',\n  lg: 'max-w-[720px]',\n  full: 'max-w-none w-screen h-[100dvh] !rounded-none',\n}\n\nexport const Modal = forwardRef<HTMLDivElement, ModalProps>(\n  (\n    {\n      isOpen,\n      onClose,\n      children,\n      size = 'md',\n      closeOnBackdropClick = true,\n      closeOnEscape = true,\n      ariaLabel,\n      className,\n      ...props\n    },\n    ref\n  ) => {\n    const internalRef = useRef<HTMLDivElement>(null)\n    const panelRef = (ref as React.RefObject<HTMLDivElement>) || internalRef\n    const previousActiveElement = useRef<HTMLElement | null>(null)\n    const labelId = useId()\n    const descriptionId = useId()\n    const [mounted, setMounted] = useState(false)\n    const [visible, setVisible] = useState(false)\n\n    // Mount/unmount with animation\n    useEffect(() => {\n      if (isOpen) {\n        setMounted(true)\n        // Trigger enter animation on next frame\n        requestAnimationFrame(() => {\n          requestAnimationFrame(() => {\n            setVisible(true)\n          })\n        })\n      } else {\n        setVisible(false)\n        const timer = setTimeout(() => setMounted(false), 200)\n        return () => clearTimeout(timer)\n      }\n    }, [isOpen])\n\n    // Lock body scroll when open\n    useEffect(() => {\n      if (isOpen) {\n        const scrollY = window.scrollY\n        document.body.style.overflow = 'hidden'\n        document.body.style.position = 'fixed'\n        document.body.style.top = `-${scrollY}px`\n        document.body.style.width = '100%'\n      } else {\n        const top = document.body.style.top\n        document.body.style.overflow = ''\n        document.body.style.position = ''\n        document.body.style.top = ''\n        document.body.style.width = ''\n        if (top) {\n          window.scrollTo(0, parseInt(top, 10) * -1)\n        }\n      }\n      return () => {\n        document.body.style.overflow = ''\n        document.body.style.position = ''\n        document.body.style.top = ''\n        document.body.style.width = ''\n      }\n    }, [isOpen])\n\n    // Escape key handler\n    useEffect(() => {\n      if (!closeOnEscape || !isOpen) return\n      const handleEscape = (e: KeyboardEvent) => {\n        if (e.key === 'Escape') {\n          e.stopPropagation()\n          onClose()\n        }\n      }\n      document.addEventListener('keydown', handleEscape)\n      return () => document.removeEventListener('keydown', handleEscape)\n    }, [isOpen, onClose, closeOnEscape])\n\n    // Focus management\n    useEffect(() => {\n      if (isOpen) {\n        previousActiveElement.current = document.activeElement as HTMLElement\n        // Focus first focusable element in panel\n        const panel = panelRef.current\n        if (panel) {\n          const firstFocusable = panel.querySelector<HTMLElement>(FOCUSABLE_SELECTOR)\n          if (firstFocusable) {\n            firstFocusable.focus()\n          } else {\n            panel.focus()\n          }\n        }\n      } else if (previousActiveElement.current) {\n        previousActiveElement.current.focus()\n        previousActiveElement.current = null\n      }\n    }, [isOpen, panelRef])\n\n    // Focus trap\n    const handleKeyDown = useCallback(\n      (e: React.KeyboardEvent) => {\n        if (e.key !== 'Tab' || !panelRef.current) return\n\n        const focusableElements =\n          panelRef.current.querySelectorAll<HTMLElement>(FOCUSABLE_SELECTOR)\n        if (focusableElements.length === 0) {\n          e.preventDefault()\n          return\n        }\n\n        const firstElement = focusableElements[0]\n        const lastElement = focusableElements[focusableElements.length - 1]\n\n        if (e.shiftKey && document.activeElement === firstElement) {\n          e.preventDefault()\n          lastElement?.focus()\n        } else if (!e.shiftKey && document.activeElement === lastElement) {\n          e.preventDefault()\n          firstElement?.focus()\n        }\n      },\n      [panelRef]\n    )\n\n    // Backdrop click handler\n    const handleBackdropClick = useCallback(\n      (e: React.MouseEvent) => {\n        if (closeOnBackdropClick && e.target === e.currentTarget) {\n          onClose()\n        }\n      },\n      [closeOnBackdropClick, onClose]\n    )\n\n    if (!mounted) return null\n\n    return createPortal(\n      <div\n        className={cn(\n          'fixed inset-0 z-50 flex items-center justify-center',\n          // Backdrop\n          'transition-[background-color,backdrop-filter] duration-200 ease-out',\n          visible\n            ? 'bg-black/60 backdrop-blur-sm'\n            : 'bg-black/0 backdrop-blur-none',\n          // Reduced motion: instant transitions\n          'motion-reduce:transition-none'\n        )}\n        onClick={handleBackdropClick}\n        aria-hidden=\"true\"\n      >\n        {/* Panel */}\n        <div\n          ref={panelRef}\n          role=\"dialog\"\n          aria-modal=\"true\"\n          aria-labelledby={ariaLabel ? undefined : labelId}\n          aria-label={ariaLabel}\n          aria-describedby={descriptionId}\n          tabIndex={-1}\n          className={cn(\n            'relative w-full mx-4',\n            sizeClasses[size],\n            // Glass panel styling\n            'bg-[var(--color-bg-secondary)] border border-[var(--glass-border)]',\n            'backdrop-blur-lg',\n            size !== 'full' && 'rounded-2xl',\n            // Focus ring\n            'focus-ring',\n            // Animation\n            'transition-[opacity,transform] duration-200 ease-out',\n            visible\n              ? 'opacity-100 scale-100 translate-y-0'\n              : 'opacity-0 scale-95 translate-y-2',\n            // Reduced motion: no scale/translate, instant\n            'motion-reduce:transition-none motion-reduce:transform-none',\n            className\n          )}\n          onKeyDown={handleKeyDown}\n          // Pass through the label/description IDs via data attributes for sub-components\n          data-modal-label-id={labelId}\n          data-modal-description-id={descriptionId}\n          {...props}\n        >\n          {children}\n        </div>\n      </div>,\n      document.body\n    )\n  }\n)\n\nModal.displayName = 'Modal'\n\n// --- Compound sub-components ---\n\nexport interface ModalHeaderProps extends HTMLAttributes<HTMLDivElement> {\n  children: ReactNode\n}\n\nexport function ModalHeader({ children, className, ...props }: ModalHeaderProps) {\n  return (\n    <div\n      className={cn(\n        'px-6 pt-6 pb-0',\n        'flex items-start justify-between gap-4',\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </div>\n  )\n}\n\nModalHeader.displayName = 'ModalHeader'\n\nexport interface ModalTitleProps extends HTMLAttributes<HTMLHeadingElement> {\n  children: ReactNode\n  as?: 'h1' | 'h2' | 'h3' | 'h4'\n}\n\nexport function ModalTitle({ children, as: Tag = 'h2', className, id, ...props }: ModalTitleProps) {\n  return (\n    <Tag\n      id={id}\n      className={cn(\n        'font-display text-lg font-semibold text-[var(--color-white)]',\n        'tracking-tight',\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </Tag>\n  )\n}\n\nModalTitle.displayName = 'ModalTitle'\n\nexport interface ModalDescriptionProps extends HTMLAttributes<HTMLParagraphElement> {\n  children: ReactNode\n}\n\nexport function ModalDescription({ children, className, id, ...props }: ModalDescriptionProps) {\n  return (\n    <p\n      id={id}\n      className={cn(\n        'text-sm text-[var(--color-grey-400)]',\n        'mt-1',\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </p>\n  )\n}\n\nModalDescription.displayName = 'ModalDescription'\n\nexport interface ModalBodyProps extends HTMLAttributes<HTMLDivElement> {\n  children: ReactNode\n}\n\nexport function ModalBody({ children, className, ...props }: ModalBodyProps) {\n  return (\n    <div\n      className={cn(\n        'px-6 py-4',\n        'overflow-y-auto',\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </div>\n  )\n}\n\nModalBody.displayName = 'ModalBody'\n\nexport interface ModalFooterProps extends HTMLAttributes<HTMLDivElement> {\n  children: ReactNode\n}\n\nexport function ModalFooter({ children, className, ...props }: ModalFooterProps) {\n  return (\n    <div\n      className={cn(\n        'px-6 pb-6 pt-0',\n        'border-t border-[var(--glass-border)]',\n        'mt-2 pt-4',\n        'flex items-center justify-end gap-3',\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </div>\n  )\n}\n\nModalFooter.displayName = 'ModalFooter'\n\nexport interface ModalCloseButtonProps extends HTMLAttributes<HTMLButtonElement> {\n  /** Accessible label for the close button */\n  ariaLabel?: string\n}\n\nexport function ModalCloseButton({\n  ariaLabel = 'Close',\n  className,\n  onClick,\n  ...props\n}: ModalCloseButtonProps) {\n  return (\n    <button\n      type=\"button\"\n      aria-label={ariaLabel}\n      className={cn(\n        'inline-flex items-center justify-center',\n        'w-8 h-8 rounded-lg',\n        'text-[var(--color-grey-400)]',\n        'hover:text-[var(--color-white)] hover:bg-[var(--glass-bg)]',\n        'transition-colors duration-200',\n        'focus-ring',\n        'motion-reduce:transition-none',\n        className\n      )}\n      onClick={onClick}\n      {...props}\n    >\n      <svg\n        width=\"16\"\n        height=\"16\"\n        viewBox=\"0 0 16 16\"\n        fill=\"none\"\n        stroke=\"currentColor\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n      >\n        <path d=\"M4 4l8 8M12 4l-8 8\" />\n      </svg>\n    </button>\n  )\n}\n\nModalCloseButton.displayName = 'ModalCloseButton'\n",
      "type": "registry:ui"
    }
  ],
  "type": "registry:ui"
}